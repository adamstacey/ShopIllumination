{% macro menuItem(parentId, departments) %}
    <ul id="submenu-department-{{ parentId }}" class="menu-vertical">
        {% for department in departments %}
            {% if department.url %}
                <li {% if department.children|length > 0 %}data-submenu="submenu-department-{{ department.id }}"{% endif %}>
                    <a class="dropdown-toggle" href="{{ path('routing', {'url': department.url}) }}">
                        {% if department.children|length > 0 %}
                            <span class="fr ui-button-icon-primary ui-icon-small icon-small-grey icon-small-471"></span>
                        {% endif %}
                        {{ department.description.name|raw }}
                    </a>
                    {% if department.children|length > 0 %}
                        {{ _self.menuItem(department.id, department.children) }}
                    {% endif %}
                </li>
            {% endif %}
        {% endfor %}
    </ul>
{% endmacro %}

{% spaceless %}
<div class="main-menu">
    <nav class="container clearfix">
        <ul class="clearfix menu-horizontal">
            {% for department in departments %}
                {% if department.url %}
                    <li data-submenu="submenu-department-{{ department.id }}">
                        <a class="{% if loop.last %}highlighted{% endif %} dropdown-toggle" href="{{ path('routing', {'url': department.url}) }}">
                            {{ department.menuTitle|raw }}
                        </a>
                        <div class="submenu-container">
                            {{ _self.menuItem(department.id, department.children) }}
                        </div>
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
        <a data-submenu="submenu-department-brands" class="ui-button button button-turquoise uppercase" href="{{ path('listing_products') }}">Brands</a>
        <div class="submenu-container submenu-container-brands">
            <div id="submenu-department-brands">
                {% for brand in brands %}
                    {% if brand.images.0.publicPath is defined and brand.url %}
                        <a class="submenu-brand" href="{{ path('routing', {'url': brand.url}) }}"><img src="{{ asset(brand.images.0.publicPath | apply_filter('logo_medium')) }}" border="0" alt="{{ brand.description.name|raw }}" width="77" height="39" /></a>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </nav>
</div>
{% endspaceless %}
