{# Forms #}
{% extends 'KACSiteBundle::base.html.twig' %}

{% block title %}Orders | {{ parent() }}{% endblock %}

{% block header %}
    <header>
        {{ parent() }}
        <h1>Orders</h1>
    </header>
{% endblock %}
{% block body %}
    <section>
        <form class="form" method="get" novalidate="novalidate" action="{{ path(app.request.attributes.get('_route'), app.request.attributes.get('_route_params')) }}" {{ form_enctype(form) }}>
            <div class="widget-group clearfix">
                <div class="widget widget-1-of-1">
                    <div class="widget-group clearfix">
                        <div class="widget widget-1-of-3">
                            {{ form_row(form.filters.id) }}
                        </div>
                        <div class="widget widget-1-of-3">
                            {{ form_row(form.filters.name) }}
                        </div>
                        <div class="widget widget-1-of-3">
                            {{ form_row(form.filters.emailAddress) }}
                        </div>
                    </div>
                    <div class="widget-group clearfix">
                        <div class="widget widget-1-of-3">
                            {{ form_row(form.filters.status) }}
                        </div>
                        <div class="widget widget-1-of-3">
                            {{ form_row(form.filters.paymentType) }}
                        </div>
                        <div class="widget widget-1-of-3">
                            {{ form_row(form.filters.deliveryType) }}
                        </div>
                    </div>
                    <div class="widget-group clearfix">
                        <div class="widget widget-1-of-2">
                            {{ form_row(form.filters.createdAtFrom) }}
                        </div>
                        <div class="widget widget-1-of-2">
                            {{ form_row(form.filters.createdAtTo) }}
                        </div>
                    </div>
                    {% do form.selected.setRendered %}
                    {% do form.queue.setRendered %}
                    {% do form.update.setRendered %}
                    <div class="clearfix mtl mbl">
                        <button type="submit" name="{{ form.queue.vars.full_name }}" class="button button-green icon-white mlm fl" data-icon-secondary="icon-1118">Add to Queue</button>
                        <a href="{{ path('orders_queue') }}" name="{{ form.queue.vars.full_name }}" class="button button-green icon-white mlm fl" data-icon-secondary="icon-1118">View Queue</a>
                        <button type="submit" name="{{ form.update.vars.full_name }}" class="button button-green icon-white mlm fr" data-icon-secondary="icon-1118">Update</button>
                        <button type="reset" class="button button-red icon-white mlm fr" data-icon-secondary="icon-1118">Clear</button>
                    </div>
                    {{ form_rest(form) }}
                </div>
            </div>
            <fieldset class="pbm">
                <table class="data-table treetable" id="departments">
                    <tr>
                        {# sorting of properties based on query components #}
                        <th></th>
                        <th{% if pagination.isSorted('o.id') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, '#', 'o.id') }}</th>
                        <th colspan="2"{% if pagination.isSorted('o.total') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Total', 'o.total') }}</th>
                        <th{% if pagination.isSorted('o.lastName') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Customer', 'o.firstName,o.lastName') }}</th>
                        <th{% if pagination.isSorted('o.createdAt') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Date', 'o.createdAt') }}</th>
                        <th{% if pagination.isSorted('o.status') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Status', 'o.status') }}</th>
                        <th></th>
                    </tr>

                    {# table body #}
                    {% for order in pagination %}
                        <tr class="{{ cycle(['odd', 'even'], loop.index0) }}">
                            <td width="1"><input type="checkbox" name="{{ form.selected.vars.full_name }}[]" class="selected" value="{{ order.id }}" {% if order.id in queue %}checked="checked"{% endif %}/></td>
                            <td width="1"><a href="{{ path('orders_view', {'id': order.id}) }}">{{ order.id }}</a></td>
                            <td>{{ order.total|currency }}</td>
                            <td>
                                {% if order.paymentType == '' %}
                                    &nbsp;-&nbsp;
                                {% else %}
                                    <img width="50" class="no-border" src="{{ asset(order.paymentTypeLogo) }}" border="0" alt="{{ order.paymentType }}" />
                                {% endif %}
                            </td>
                            <td>{{ order.firstName }} {{ order.lastName }}</td>
                            <td>{{ order.createdAt|date("d/m/Y h:iA") }}</td>
                            <td>
                                {{ order.status }}
                            </td>
                            <td width="1" class="buttons-container ac no-wrap">
                                {#<a data-id="{{ order.id }}" href="/uploads/documents/order/order-{{ order.id }}.pdf" target="_blank" class="button icon-set-white ui-button-{{ (order.orderPrinted == 1?'green':'red') }} action-print-order ui-corner-right tooltip-preview-right" data-icon-primary="ui-icon-document" data-icon-only="true" data-tooltip-id="#tooltip-documents-{{ order.id }}" data-ajax-path="{{ path('admin_orders_ajax_get_documents') }}" data-id="{{ order.id }}">Order</a>#}
                                {#<a{% if (order.trackingNumber != '') and (order.courier != '') %} target="_blank"{% endif %} href="{{ path('admin_'~data.settings.multiplePath~'_update_delivery', {'id': order.id}) }}" class="button icon-set-white ui-button-{% if order.deliveryType == 'Collection' %}red{% elseif order.deliveryCharge == 0 %}green{% else %}black{% endif %} ui-corner-none tooltip-preview-right" data-icon-primary="ui-icon-delivery-truck" data-icon-only="true" data-tooltip-id="#tooltip-delivery-information-{{ order.id }}" data-ajax-path="{{ path('admin_orders_ajax_get_delivery_information') }}" data-id="{{ order.id }}">Delivery Information</a>#}
                                {#<a href="{{ path('admin_'~data.settings.multiplePath~'_update_payment', {'id': order.id}) }}" class="button icon-set-white ui-button-{% if order.paymentType == '' %}red{% else %}{{ order.paymentResponseFraudColour }}{% endif %} ui-corner-none tooltip-preview-right" data-icon-primary="ui-icon-credit-card-back" data-icon-only="true" data-tooltip-id="#tooltip-payment-information-{{ order.id }}" data-ajax-path="{{ path('admin_orders_ajax_get_payment_information') }}" data-id="{{ order.id }}">Payment Information</a>#}
                                {#<a href="{{ path('admin_'~data.settings.multiplePath~'_update_notes', {'id': order.id}) }}" class="button tooltip-preview-right icon-set-white ui-button-black ui-corner-none" data-icon-primary="ui-icon-written-speech-bubble" data-icon-only="true"{% if order.notesCount > 0 %} data-notification="{{ order.notesCount }}" data-tooltip-id="#tooltip-notes-{{ order.id }}" data-ajax-path="{{ path('admin_orders_ajax_get_notes') }}" data-id="{{ order.id }}"{% endif %}>Customer Notes</a>#}
                                {#<a href="{{ path('admin_'~data.settings.multiplePath~'_update_products', {'id': order.id}) }}" class="button icon-set-white ui-button-black ui-corner-none tooltip-preview-right" data-icon-primary="ui-icon-shopping-basket" data-icon-only="true" data-notification="{{ order.items }}" data-tooltip-id="#tooltip-products-{{ order.id }}" data-ajax-path="{{ path('admin_orders_ajax_get_products') }}" data-id="{{ order.id }}">Shopping Basket</a>#}
                                {#<a href="{{ path('admin_'~data.settings.multiplePath~'_update_delivery', {'id': order.id}) }}" class="button icon-set-white ui-button-black ui-corner-left" data-icon-primary="ui-icon-pencil" data-icon-only="true">Edit</a>#}
                                <a href="{{ path('orders_delete', {'id': order.id}) }}" class="button button-red button-small fr mls">Delete</a>
                                <a href="{{ path('orders_edit', {'id': order.id}) }}" class="button button-blue button-small fr">Edit</a>
                            </td>
                        </tr>
                    {% endfor %}
                </table>
            </fieldset>
        </form>
        <div class="widget-group product-sorting-container product-sorting-container-bottom mbn clearfix">
            <div class="widget widget-1-of-1">
                <span class="fl">of <strong>{{ totalItemCount }}</strong> Product{{ totalItemCount == 1 ? '' : 's' }}</span>
                <div class="fr">
                    {{ knp_pagination_render(pagination) }}
                </div>
            </div>
        </div>
    </section>
{% endblock %}