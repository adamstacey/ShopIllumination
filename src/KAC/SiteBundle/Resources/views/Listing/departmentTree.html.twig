<h5 id="filter-brand-header" class="no-margin">
    {% spaceless %}
        Department
        <button data-filter="department" class="fr button button-small button-grey action-show-hide-filter">Reset</button>
        <button data-filter="department" class="fr button button-small button-grey action-reset-filter">Hide</button>
    {% endspaceless %}
</h5>
<div id="filter-department-container">
    <div id="filter-department" class="filter">
        <ul>
            {{  _self.render_departments(departments, brand, 1) }}
        </ul>
    </div>
</div>

{% macro render_departments(departments, brand, level) %}
    {% for department in departments %}
        <li>
            {% if brand is null %}
                {% set url = get_listing_url('department', department.id) %}
                {%  if url %}
                    <a href="{{ path('routing', {'url': url}|merge(app.request.query.all)) }}">{{ department.description.header }}</a>
                {% else %}
                    <a href="{{ path('listing_department', {'departmentId': department.id}|merge(app.request.query.all)) }}">{{ department.description.header }}</a>
                {% endif %}
            {% else %}
                {% set url = get_listing_url('brand_with_department', brand.id, department.id) %}
                {%  if url %}
                    <a href="{{ path('routing', {'url': url}|merge(app.request.query.all)) }}">{{ department.description.header }}</a>
                {% else %}
                    <a href="{{ path('listing_department_brand', {'departmentId': department.id, 'brandId': brand.id}|merge(app.request.query.all)) }}">{{ department.description.header }}</a>
                {% endif %}
            {% endif %}
            {% if department.children|length > 0 %}
                <ul>
                    {{  _self.render_departments(department.children, brand, level+1) }}
                </ul>
            {% endif %}
        </li>
    {% endfor %}
{% endmacro %}