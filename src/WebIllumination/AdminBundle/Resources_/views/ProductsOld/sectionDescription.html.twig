<section id="description">
	<div class="info-message ui-status-highlight">
		<span class="info-message-icon ui-icon ui-icon-info"></span>
		<p>The description is what sells the product and it is important that you explain how a potential customer will benefit from buying this product from you.</p>
		<div class="clear"></div>
	</div>
	<div class="clearfix">
        <label for="form-description" class="form-label">Description<small>A full detailed description of the product</small></label>
        <div class="form-input">
        	<div class="ac">
                <div class="buttonset no-margin-right">
                    <input type="radio" class="show-tinymce" rel="#form-description" name="tinymce-description" value="1" id="tinymce-description-1" checked="checked" /><label for="tinymce-description-1">Visual</label>
                    <input type="radio" class="show-tinymce" rel="#form-description" name="tinymce-description" value="0" id="tinymce-description-0" /><label for="tinymce-description-0">HTML</label>
                    <hr class="inset" />
                </div>
                <div class="leading">
                    <textarea id="form-description" name="description" rows="3" class="tinymce-basic">{{ product_description.description }}</textarea>
                </div>
            </div>
        </div>
    </div>
    <div class="clearfix">
        <label for="form-short-description" class="form-label">Short Description<small>Short description of the product</small></label>
        <div class="form-input"><textarea id="form-short-description" name="short-description" rows="3">{{ product_description.shortDescription }}</textarea></div>
    </div>
    <div class="clearfix">
        <div class="form-input buttons no-margin-bottom">
        	<button class="button ui-button-default">Save</button>
        	<a class="button action-get-description" href="Javascript:void(0);">Build Description</a>
        	<a class="button action-get-short-description" href="Javascript:void(0);">Build Short Description</a>
        </div>
    </div>
    <script type="text/javascript">
		$(document).ready(function() {
		
			{# Update the description tab #}
			{% if ((product_description.shortDescription == "") and (product_description.description == "")) %}
				$("#tab-description").addClass("ui-status-error");
			{% elseif ((product_description.shortDescription == "") or (product_description.description == "")) %}
				$("#tab-description").addClass("ui-status-highlight");
			{% else %}
				$("#tab-description").addClass("ui-status-success");
			{% endif %}
			$("#form-short-description, #form-description").change(function() {
				$("#tab-description").removeClass("ui-status-success").removeClass("ui-status-highlight").removeClass("ui-status-error");
				if ($("#form-description").val() == "")
				{
					$("#tab-description").addClass("ui-status-error");
				} else if ($("#form-short-description").val() == "") {
					$("#tab-description").addClass("ui-status-highlight");
				} else {
					$("#tab-description").addClass("ui-status-success");
				}
			});
			
			{# Get the description #}
			$(".action-get-description").live('click', function() {
				if ($("#form-short-description").val() != "")
				{
					var editor = tinyMCE.get("form-description");
					if (editor.getContent() != "")
					{
						if (confirm("Your current description will be replaced. Do you want to continue?"))
						{
							$("#ajax_loading").show();
							$('#form-description').addClass("disabled");
							$.ajax({
								type: "POST",
								url: "{{ path('products_ajax_get_description') }}",
							    data: {short_description: $("#form-short-description").val()},
							   	success: function(content) {
		        					editor.setContent(content);
		        					$('#form-description').removeClass("disabled");
							    	$("#ajax_loading").hide();
							   	}
							});
						}
					} else {
						$("#ajax_loading").show();
						$('#form-description').addClass("disabled");
						$.ajax({
							type: "POST",
							url: "{{ path('products_ajax_get_description') }}",
						    data: {short_description: $("#form-short-description").val()},
						   	success: function(content) {
	        					editor.setContent(content);
	        					$('#form-description').removeClass("disabled");
						    	$("#ajax_loading").hide();
						   	}
						});
					}
				}
			});
			
			{# Get the short description #}
			$(".action-get-short-description").live('click', function() {
				var editor = tinyMCE.get("form-description");
				if (editor.getContent() != "")
				{	
					if ($('#form-short-description').val() != "")
					{
						if (confirm("Your current short description will be replaced. Do you want to continue?"))
						{
							$("#ajax_loading").show();
							$('#form-short-description').addClass("disabled");
							$.ajax({
								type: "POST",
								url: "{{ path('products_ajax_get_short_description') }}",
							    data: {description: editor.getContent()},
							   	success: function(content) {
							    	$('#form-short-description').val(content);
							    	$('#form-short-description').removeClass("disabled");
							    	$("#ajax_loading").hide();
							   	}
							});
						}
					} else {
						$("#ajax_loading").show();
						$('#form-short-description').addClass("disabled");
						$.ajax({
							type: "POST",
							url: "{{ path('products_ajax_get_short_description') }}",
						    data: {description: editor.getContent()},
						   	success: function(content) {
						    	$('#form-short-description').val(content);
						    	$('#form-short-description').removeClass("disabled");
						    	$("#ajax_loading").hide();
						   	}
						});
					}
				}
			});
			
		});
		
	</script>
</section>