<div class="grid_4 grid-listings">
    <div class="portlet">
        <header>
            <h2 id="product-count">Found {{ pagination.totalItemCount is defined ? pagination.totalItemCount : 0 }} Products</h2>
        </header>
        <section class="clearfix no-padding-right no-padding-bottom">
            <form id="form-filter" class="form" method="GET">
                <div id="product-sorting">
                    <div class="fl">
                        <div class="product-sorting-title fl">Sort By</div>
                        <select name="sort_order" id="listing-sort-order" class="fl">
                            <option{% if app.request.get('sort_order') == 'header_sort:asc' %} selected="selected"{% endif %} value="header_sort:asc">Alphabetically: A-Z</option>
                            <option{% if app.request.get('sort_order') == 'header_sort:desc' %} selected="selected"{% endif %} value="header_sort:desc">Alphabetically: Z-A</option>
                            <option{% if app.request.get('sort_order') == 'list_price:asc' %} selected="selected"{% endif %} value="list_price:asc">Price: Lowest First</option>
                            <option{% if app.request.get('sort_order') == 'list_price:desc' %} selected="selected"{% endif %} value="list_price:desc">Price: Highest First</option>
                            <option{% if app.request.get('sort_order') == 'created_at:desc' %} selected="selected"{% endif %} value="created_at:desc">Latest</option>
                        </select>
                    </div>
                    <div class="fr">
                        <div class="product-sorting-title fl">Per Page</div>
                        <select name="limit" class="fl" id="listing-max-results">
                            <option{% if app.request.get('limit') == '10' %} selected="selected"{% endif %} value="10">10</option>
                            <option{% if app.request.get('limit') == '20' %} selected="selected"{% endif %} value="20">20</option>
                            <option{% if app.request.get('limit') == '50' %} selected="selected"{% endif %} value="50">50</option>
                            <option{% if app.request.get('limit') == '100' %} selected="selected"{% endif %} value="100">100</option>
                            <option{% if app.request.get('limit') == '99999999' %} selected="selected"{% endif %} value="99999999">All</option>
                        </select>
                    </div>
                    <div class="clear"></div>
                </div>
            </form>
            <div id="product-pagination-top" class="padding-bottom-15 padding-right-15">
                {{ pagination.render()|raw }}
            </div>
            <div id="products">
                {% for product in pagination %}
                    <div itemscope itemtype="http://schema.org/Product" class="product relative" data-product-id="{{ product.id }}" id="product-{{ product.id }}">
                        <div class="fl">
                            <a href="{#{{ path('page_request', {'url': product.url}) }}#}"><img class="fl product-image" itemprop="image" src="{{ asset(product.thumbnail_path) }}" border="0" alt="{{ product.header|raw }}" width="150" height="150"></a>
                        </div>
                        <div>
                            <div>
                                {% if product.brand_logo != '' %}
                                    <a href="{#{{ path('page_request', {'url': product.brandUrl}) }}#}"><img class="fr brand-logo-image" src="{{ asset(product.brand_logo) }}" border="0" alt="{{ product.brand|raw }}" width="48" height="23"></a>
                                {% endif %}
                                <h4><a itemprop="name" href="{#{{ path('page_request', {'url': product.url}) }}#}">{{ product.header|raw }}</a></h4>
                                {% for productFeature in product.productFeatures|explode('|') %}
                                    {% if 'COLOUR:' in productFeature|upper %}
                                        <p class="colour">{% spaceless %}
                                                {% if product.url != '' %}
                                                    <a href="{#{{ path('page_request', {'url': product.url}) }}#}">
                                                {% endif %}
                                                <strong>{{ productFeature|upper|replace({'COLOUR:': ''}) }}</strong>
                                                {% if product.url != '' %}
                                                    </a>
                                                {% endif %}
                                            {% endspaceless %}</p>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <div class="product-options">
                                <div itemprop="offers" itemscope itemtype="http://schema.org/Offer">
                                    <p class="ar product-price">
                                        {% spaceless %}
                                            {% if product.hide_price == 0 %}
                                                {% if product.url != '' %}
                                                    <a href="{#{{ path('page_request', {'url': url}) }}#}">
                                                {% endif %}
                                                {% if product.low_price == product.high_price %}
                                                    <span itemprop="price">&pound;{{ product.low_price|number_format(2) }}</span>
                                                {% else %}
                                                    <span itemprop="price">&pound;{{ product.low_price|number_format(2) }}</span>
                                                    <em> - </em>
                                                    <span itemprop="price">&pound;{{ product.high_price|number_format(2) }}</span>
                                                {% endif %}
                                                {% if product.url != '' %}
                                                    </a>
                                                {% endif %}
                                                <span class="product-tax"> (inc. VAT)</span>
                                            {% else %}
                                                <a itemprop="price" href="{#{{ path('content_contact_us') }}#}">CONTACT US</a>
                                            {% endif %}
                                        {% endspaceless %}
                                    </p>
                                </div>

                                <a href="{#{{ path('page_request', {'url': product.url}) }}#}" class="fr button ui-button-blue margin-bottom-5">More Info</a>
                                <div class="buy-now">
                                    {% if (product.availableForPurchase == 1) and (product.hidePrice == 0) %}
                                        <table class="fr no-padding no-border" align="right" cellpadding="0" cellspacing="0" border="0">
                                            <tr>
                                                {% if product.productCode == '' %}
                                                    <td class="out-of-stock">Out of Stock Until Further Notice</td>
                                                {% else %}
                                                    <td class="no-padding no-border"><input id="quantity-{{ product.productId }}" data-product-id="{{ product.productId }}" class="ui-corner-none ui-corner-left number quantity" width="20" type="text" value="1" /></td>
                                                    <td class="no-padding no-border">
                                                        <div class="quantity-buttons-container no-padding">
                                                            <div class="ui-corner-none ui-corner-tr action-increase-quantity" data-quantity-object="quantity-{{ product.productId }}">+</div>
                                                            <div class="ui-corner-none ui-corner-br action-decrease-quantity" data-quantity-object="quantity-{{ product.productId }}">-</div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <button data-product-id="{{ product.productId }}" class="action-add-to-basket button margin-left-5 ui-button-green">Add to Basket</button>
                                                    </td>
                                                {% endif %}
                                            </tr>
                                        </table>
                                        <input type="hidden" value="" id="selected-options-{{ product.productId }}">
                                    {% else %}
                                        <a href="{#{{ path('content_contact_us') }}#}" class="fr button ui-button-green">Contact Us to Buy</a>
                                    {% endif %}
                                </div>
                                {% if (app.request.attributes.get('_route') == 'products_ajax_get_product_listing') %}
                                    {% if not group %}
                                        {% if product.productGroupCode %}
                                            {#<!--<a href="{{ path('department_with_group', {'group': product.productGroupId, 'url': product.url}) }}" class="fr padding-right-5 small button ui-button-blue">View Other Colours or Options for this product</a>-->#}
                                        {% endif %}
                                    {% endif %}
                                {% endif %}
                                {% if product.cheaperAlternativePrice is defined %}
                                    {% if (product.cheaperAlternativePrice > 0) and (product.cheaperAlternativeUrl != '') %}
                                        <a href="{#{{ path('page_request', {'url': product.cheaperAlternativeUrl}) }}#}" class="cheaper-alternative-listing">Cheaper Alternative <strong>&pound;{{ product.cheaperAlternativePrice|number_format(0) }}</strong></a>
                                    {% endif %}
                                {% endif %}
                            </div>
                            <div class="product-information">
                                {% if (product.description) %}
                                    {{ product.description.description|raw }}
                                {% endif %}
                            </div>
                            {% if '|1034|1122|69|' in product.departmentIds %}
                                <div class="small-floating-offer small-floating-offer-top-left">
                                    <p class="small-floating-offer-title">40% OFF</p>
                                    <p class="small-floating-offer-description">Stellar<br />Pans</p>
                                </div>
                            {% endif %}
                            {% if product.brandId == '7' %}
                                <div class="medium-floating-offer medium-floating-offer-bottom-left">
                                    <p class="medium-floating-offer-title">10% OFF</p>
                                    <p class="medium-floating-offer-description">When you buy 3 or more CDA items</p>
                                </div>
                            {% endif %}
                            <div class="clear"></div>
                        </div>
                        <div class="clear"></div>
                    </div>
                {% else %}
                    <p class="no-products">Sorry, there are currently no products in this department.</p>
                {% endfor %}
                <div class="clear"></div>
            </div>
            <div id="product-pagination-bottom" class="padding-bottom-15 padding-right-15">
                {{ pagination.render()|raw }}
            </div>
            <div class="clear"></div>
        </section>
    </div>
</div>