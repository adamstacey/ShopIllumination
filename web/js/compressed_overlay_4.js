(function(e){var c=e.tools.overlay,a=e(window);e.extend(c.conf,{start:{top:null,left:null},fadeInSpeed:"fast",zIndex:9999});function b(g){var h=g.offset();return{top:h.top+g.height()/2,left:h.left+g.width()/2}}var d=function(r,q){var k=this.getOverlay(),m=this.getConf(),i=this.getTrigger(),o=this,l=k.outerWidth({margin:true}),h=k.data("img"),j=m.fixed?"fixed":"absolute";if(!h){var n=k.css("backgroundImage");if(!n){throw"background-image CSS property not set for overlay"}n=n.slice(n.indexOf("(")+1,n.indexOf(")")).replace(/\"/g,"");k.css("backgroundImage","none");h=e('<img src="'+n+'"/>');h.css({border:0,display:"none"}).width(l);e("body").append(h);k.data("img",h)}var t=m.start.top||Math.round(a.height()/2),g=m.start.left||Math.round(a.width()/2);if(i){var s=b(i);t=s.top;g=s.left}if(m.fixed){t-=a.scrollTop();g-=a.scrollLeft()}else{r.top+=a.scrollTop();r.left+=a.scrollLeft()}h.css({position:"absolute",top:t,left:g,width:0,zIndex:m.zIndex}).show();r.position=j;k.css(r);h.animate({top:r.top,left:r.left,width:l},m.speed,function(){k.css("zIndex",m.zIndex+1).fadeIn(m.fadeInSpeed,function(){if(o.isOpened()&&!e(this).index(k)){q.call()}else{k.hide()}})}).css("position",j)};var f=function(i){var k=this.getOverlay().hide(),j=this.getConf(),g=this.getTrigger(),l=k.data("img"),h={top:j.start.top,left:j.start.left,width:0};if(g){e.extend(h,b(g))}if(j.fixed){l.css({position:"absolute"}).animate({top:"+="+a.scrollTop(),left:"+="+a.scrollLeft()},0)}l.animate(h,j.closeSpeed,i)};c.addEffect("apple",d,f)})(jQuery);