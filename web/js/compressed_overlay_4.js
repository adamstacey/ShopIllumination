(function(f){var e=f.tools.overlay,b=f(window);f.extend(e.conf,{start:{top:null,left:null},fadeInSpeed:"fast",zIndex:9999});function d(g){var h=g.offset();return{top:h.top+g.height()/2,left:h.left+g.width()/2}}var a=function(g,n){var r=this.getOverlay(),j=this.getConf(),t=this.getTrigger(),o=this,h=r.outerWidth({margin:true}),k=r.data("img"),i=j.fixed?"fixed":"absolute";if(!k){var m=r.css("backgroundImage");if(!m){throw"background-image CSS property not set for overlay"}m=m.slice(m.indexOf("(")+1,m.indexOf(")")).replace(/\"/g,"");r.css("backgroundImage","none");k=f('<img src="'+m+'"/>');k.css({border:0,display:"none"}).width(h);f("body").append(k);r.data("img",k)}var s=j.start.top||Math.round(b.height()/2),l=j.start.left||Math.round(b.width()/2);if(t){var q=d(t);s=q.top;l=q.left}if(j.fixed){s-=b.scrollTop();l-=b.scrollLeft()}else{g.top+=b.scrollTop();g.left+=b.scrollLeft()}k.css({position:"absolute",top:s,left:l,width:0,zIndex:j.zIndex}).show();g.position=i;r.css(g);k.animate({top:g.top,left:g.left,width:h},j.speed,function(){r.css("zIndex",j.zIndex+1).fadeIn(j.fadeInSpeed,function(){if(o.isOpened()&&!f(this).index(r)){n.call()}else{r.hide()}})}).css("position",i)};var c=function(i){var k=this.getOverlay().hide(),h=this.getConf(),g=this.getTrigger(),j=k.data("img"),l={top:h.start.top,left:h.start.left,width:0};if(g){f.extend(l,d(g))}if(h.fixed){j.css({position:"absolute"}).animate({top:"+="+b.scrollTop(),left:"+="+b.scrollLeft()},0)}j.animate(l,h.closeSpeed,i)};e.addEffect("apple",a,c)})(jQuery);