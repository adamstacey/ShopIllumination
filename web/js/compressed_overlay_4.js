(function(a){var c=a.tools.overlay,f=a(window);a.extend(c.conf,{start:{top:null,left:null},fadeInSpeed:"fast",zIndex:9999});function b(h){var g=h.offset();return{top:g.top+h.height()/2,left:g.left+h.width()/2}}var e=function(r,g){var o=this.getOverlay(),j=this.getConf(),s=this.getTrigger(),t=this,q=o.outerWidth({margin:true}),l=o.data("img"),i=j.fixed?"fixed":"absolute";if(!l){var m=o.css("backgroundImage");if(!m){throw"background-image CSS property not set for overlay"}m=m.slice(m.indexOf("(")+1,m.indexOf(")")).replace(/\"/g,"");o.css("backgroundImage","none");l=a('<img src="'+m+'"/>');l.css({border:0,display:"none"}).width(q);a("body").append(l);o.data("img",l)}var k=j.start.top||Math.round(f.height()/2),n=j.start.left||Math.round(f.width()/2);if(s){var h=b(s);k=h.top;n=h.left}if(j.fixed){k-=f.scrollTop();n-=f.scrollLeft()}else{r.top+=f.scrollTop();r.left+=f.scrollLeft()}l.css({position:"absolute",top:k,left:n,width:0,zIndex:j.zIndex}).show();r.position=i;o.css(r);l.animate({top:r.top,left:r.left,width:q},j.speed,function(){o.css("zIndex",j.zIndex+1).fadeIn(j.fadeInSpeed,function(){if(t.isOpened()&&!a(this).index(o)){g.call()}else{o.hide()}})}).css("position",i)};var d=function(g){var j=this.getOverlay().hide(),k=this.getConf(),i=this.getTrigger(),h=j.data("img"),l={top:k.start.top,left:k.start.left,width:0};if(i){a.extend(l,b(i))}if(k.fixed){h.css({position:"absolute"}).animate({top:"+="+f.scrollTop(),left:"+="+f.scrollLeft()},0)}h.animate(l,k.closeSpeed,g)};c.addEffect("apple",e,d)})(jQuery);