(function(e){var f=e.tools.overlay,c=e(window);e.extend(f.conf,{start:{top:null,left:null},fadeInSpeed:"fast",zIndex:9999});function d(h){var g=h.offset();return{top:g.top+h.height()/2,left:g.left+h.width()/2}}var b=function(o,g){var l=this.getOverlay(),j=this.getConf(),t=this.getTrigger(),n=this,k=l.outerWidth({margin:true}),h=l.data("img"),m=j.fixed?"fixed":"absolute";if(!h){var s=l.css("backgroundImage");if(!s){throw"background-image CSS property not set for overlay"}s=s.slice(s.indexOf("(")+1,s.indexOf(")")).replace(/\"/g,"");l.css("backgroundImage","none");h=e('<img src="'+s+'"/>');h.css({border:0,display:"none"}).width(k);e("body").append(h);l.data("img",h)}var r=j.start.top||Math.round(c.height()/2),i=j.start.left||Math.round(c.width()/2);if(t){var q=d(t);r=q.top;i=q.left}if(j.fixed){r-=c.scrollTop();i-=c.scrollLeft()}else{o.top+=c.scrollTop();o.left+=c.scrollLeft()}h.css({position:"absolute",top:r,left:i,width:0,zIndex:j.zIndex}).show();o.position=m;l.css(o);h.animate({top:o.top,left:o.left,width:k},j.speed,function(){l.css("zIndex",j.zIndex+1).fadeIn(j.fadeInSpeed,function(){if(n.isOpened()&&!e(this).index(l)){g.call()}else{l.hide()}})}).css("position",m)};var a=function(l){var k=this.getOverlay().hide(),i=this.getConf(),h=this.getTrigger(),g=k.data("img"),j={top:i.start.top,left:i.start.left,width:0};if(h){e.extend(j,d(h))}if(i.fixed){g.css({position:"absolute"}).animate({top:"+="+c.scrollTop(),left:"+="+c.scrollLeft()},0)}g.animate(j,i.closeSpeed,l)};f.addEffect("apple",b,a)})(jQuery);