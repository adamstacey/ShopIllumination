(function(c){var f=c.tools.overlay,a=c(window);c.extend(f.conf,{start:{top:null,left:null},fadeInSpeed:"fast",zIndex:9999});function b(h){var g=h.offset();return{top:g.top+h.height()/2,left:g.left+h.width()/2}}var e=function(q,h){var t=this.getOverlay(),i=this.getConf(),l=this.getTrigger(),j=this,o=t.outerWidth({margin:true}),g=t.data("img"),n=i.fixed?"fixed":"absolute";if(!g){var s=t.css("backgroundImage");if(!s){throw"background-image CSS property not set for overlay"}s=s.slice(s.indexOf("(")+1,s.indexOf(")")).replace(/\"/g,"");t.css("backgroundImage","none");g=c('<img src="'+s+'"/>');g.css({border:0,display:"none"}).width(o);c("body").append(g);t.data("img",g)}var m=i.start.top||Math.round(a.height()/2),r=i.start.left||Math.round(a.width()/2);if(l){var k=b(l);m=k.top;r=k.left}if(i.fixed){m-=a.scrollTop();r-=a.scrollLeft()}else{q.top+=a.scrollTop();q.left+=a.scrollLeft()}g.css({position:"absolute",top:m,left:r,width:0,zIndex:i.zIndex}).show();q.position=n;t.css(q);g.animate({top:q.top,left:q.left,width:o},i.speed,function(){t.css("zIndex",i.zIndex+1).fadeIn(i.fadeInSpeed,function(){if(j.isOpened()&&!c(this).index(t)){h.call()}else{t.hide()}})}).css("position",n)};var d=function(j){var i=this.getOverlay().hide(),g=this.getConf(),l=this.getTrigger(),k=i.data("img"),h={top:g.start.top,left:g.start.left,width:0};if(l){c.extend(h,b(l))}if(g.fixed){k.css({position:"absolute"}).animate({top:"+="+a.scrollTop(),left:"+="+a.scrollLeft()},0)}k.animate(h,g.closeSpeed,j)};f.addEffect("apple",e,d)})(jQuery);